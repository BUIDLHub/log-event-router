{"version":3,"sources":["../src/Router.js"],"names":["Router","props","globalHandlers","contextHandlers","errorHandler","forEach","fn","bind","args","length","context","shift","ex","push","a","ctx","block","txns","transactions","i","t","txn","h","process","tgt","fnContext"],"mappings":";;;;;;;;;;;;;;IACqBA,M;AACnB,kBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,SAAKC,cAAL,GAAsB,EAAtB;AACA,SAAKC,eAAL,GAAuB,EAAvB;AACA,SAAKC,YAAL,GAAoBH,MAAMG,YAA1B;;AAEA,KACE,KADF,EAEE,SAFF,EAGEC,OAHF,CAGU;AAAA,aAAI,MAAKC,EAAL,IAAS,MAAKA,EAAL,EAASC,IAAT,CAAc,KAAd,CAAb;AAAA,KAHV;AAID;;;;0BAEY;AAAA,wCAANC,IAAM;AAANA,YAAM;AAAA;;AACX,UAAGA,KAAKC,MAAL,KAAgB,CAAnB,EAAsB;AACpB,eAAO,IAAP;AACD;AACD,UAAIC,UAAUF,KAAKG,KAAL,EAAd;AACA,UAAG,OAAOD,OAAP,KAAmB,QAAtB,EAAgC;AAC9B,YAAIE,KAAK,KAAKT,eAAL,CAAqBO,OAArB,KAAiC,EAA1C;AACAF,aAAKH,OAAL,CAAa;AAAA,iBAAGO,GAAGC,IAAH,CAAQC,CAAR,CAAH;AAAA,SAAb;AACA,aAAKX,eAAL,CAAqBO,OAArB,IAAgCE,EAAhC;AACD,OAJD,MAIO;AACL,aAAKV,cAAL,CAAoBW,IAApB,CAAyBH,OAAzB;AACD;AACD,aAAO,IAAP;AACD;;;;0FAEaK,G,EAAKC,K;;;;;;;AACbC,oB,GAAOD,MAAME,Y;AACTC,iB,GAAE,C;;;sBAAEA,IAAEF,KAAKR,M;;;;;AACbW,iB,GAAIH,KAAKE,CAAL,C;;AACRJ,mCACKA,GADL;AAEEM,uBAAKD;AAFP;;AAKUD,kB,GAAE,C;;;sBAAEA,KAAE,KAAKjB,cAAL,CAAoBO,M;;;;;AAC5Ba,iB,GAAI,KAAKpB,cAAL,CAAoBiB,EAApB,C;;sBACL,OAAOG,CAAP,KAAa,U;;;;;;uBACRA,EAAEP,GAAF,C;;;;;;;sBACE,OAAOO,EAAEC,OAAT,KAAqB,U;;;;;;uBACvBD,EAAEC,OAAF,CAAUR,GAAV,C;;;AAL+B,kBAAEI,E;;;;;AASvCK,mB,GAAM,KAAKrB,eAAL,CAAqBiB,EAAEK,SAAvB,C;;qBACPD,G;;;;;AACOL,mB,GAAE,C;;;sBAAEA,MAAEK,IAAIf,M;;;;;AACZa,kB,GAAIE,IAAIL,GAAJ,C;;sBACL,OAAOG,EAAP,KAAa,U;;;;;;uBACRA,GAAEP,GAAF,C;;;;;;;sBACE,OAAOO,GAAEC,OAAT,KAAqB,U;;;;;;uBACvBD,GAAEC,OAAF,CAAUR,GAAV,C;;;AALe,kBAAEI,G;;;;;;;;;;;;AAW7B,oBAAG,KAAKf,YAAR,EAAsB;AACpB,uBAAKA,YAAL;AACD;;;AA/BqB,kBAAEe,C;;;;;;;;;;;;;;;;;;;;;;;kBA7BXnB,M","file":"Router.js","sourcesContent":["\nexport default class Router {\n  constructor(props) {\n    this.globalHandlers = [];\n    this.contextHandlers = {};\n    this.errorHandler = props.errorHandler;\n\n    [\n      'use',\n      'process'\n    ].forEach(fn=>this[fn]=this[fn].bind(this));\n  }\n\n  use(...args) {\n    if(args.length === 0) {\n      return this;\n    }\n    let context = args.shift();\n    if(typeof context === 'string') {\n      let ex = this.contextHandlers[context] || [];\n      args.forEach(a=>ex.push(a));\n      this.contextHandlers[context] = ex;\n    } else {\n      this.globalHandlers.push(context);\n    }\n    return this;\n  }\n\n  async process(ctx, block) {\n    let txns = block.transactions;\n    for(let i=0;i<txns.length;++i) {\n      let t = txns[i];\n      ctx = {\n        ...ctx,\n        txn: t\n      };\n      try {\n        for(let i=0;i<this.globalHandlers.length;++i) {\n          let h = this.globalHandlers[i];\n          if(typeof h === 'function') {\n            await h(ctx);\n          } else if(typeof h.process === 'function') {\n            await h.process(ctx);\n          }\n        }\n\n        let tgt = this.contextHandlers[t.fnContext];\n        if(tgt) {\n          for(let i=0;i<tgt.length;++i) {\n            let h = tgt[i];\n            if(typeof h === 'function') {\n              await h(ctx);\n            } else if(typeof h.process === 'function') {\n              await h.process(ctx);\n            }\n          }\n        }\n\n      } catch (e) {\n        if(this.errorHandler) {\n          this.errorHandler(e);\n        }\n      }\n    }\n  }\n}\n"]}