{"version":3,"sources":["../src/Router.js"],"names":["Router","props","globalHandlers","contextHandlers","errorHandler","forEach","fn","bind","args","length","context","shift","ex","push","a","ctx","bundle","i","h","outB","process","tgt","fnContext"],"mappings":";;;;;;;;;;;;;;IACqBA,M;AACnB,kBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,SAAKC,cAAL,GAAsB,EAAtB;AACA,SAAKC,eAAL,GAAuB,EAAvB;AACA,SAAKC,YAAL,GAAoBH,MAAMG,YAA1B;;AAEA,KACE,KADF,EAEE,SAFF,EAGEC,OAHF,CAGU;AAAA,aAAI,MAAKC,EAAL,IAAS,MAAKA,EAAL,EAASC,IAAT,CAAc,KAAd,CAAb;AAAA,KAHV;AAID;;;;0BAEY;AAAA,wCAANC,IAAM;AAANA,YAAM;AAAA;;AACX,UAAGA,KAAKC,MAAL,KAAgB,CAAnB,EAAsB;AACpB,eAAO,IAAP;AACD;AACD,UAAIC,UAAUF,KAAKG,KAAL,EAAd;AACA,UAAG,OAAOD,OAAP,KAAmB,QAAtB,EAAgC;AAC9B,YAAIE,KAAK,KAAKT,eAAL,CAAqBO,OAArB,KAAiC,EAA1C;AACAF,aAAKH,OAAL,CAAa;AAAA,iBAAGO,GAAGC,IAAH,CAAQC,CAAR,CAAH;AAAA,SAAb;AACA,aAAKX,eAAL,CAAqBO,OAArB,IAAgCE,EAAhC;AACD,OAJD,MAIO;AACL,aAAKV,cAAL,CAAoBW,IAApB,CAAyBH,OAAzB;AACD;AACD,aAAO,IAAP;AACD;;;;0FAEaK,G,EAAKC,M;;;;;;;;AAEjBD,mCACKA,GADL;AAEEC;AAFF;;;AAMUC,iB,GAAE,C;;;sBAAEA,IAAE,KAAKf,cAAL,CAAoBO,M;;;;;AAC5BS,iB,GAAI,KAAKhB,cAAL,CAAoBe,CAApB,C;;sBACL,OAAOC,CAAP,KAAa,U;;;;;;uBACGA,EAAEH,GAAF,C;;;AAAbI,oB;;AACJ,oBAAGA,IAAH,EAAS;AACPJ,sBAAIC,MAAJ,GAAaG,IAAb;AACD;;;;;sBACO,OAAOD,EAAEE,OAAT,KAAqB,U;;;;;;uBACZF,EAAEE,OAAF,CAAUL,GAAV,C;;;AAAbI,qB;;AACJ,oBAAGA,KAAH,EAAS;AACPJ,sBAAIC,MAAJ,GAAaG,KAAb;AACD;;;AAXoC,kBAAEF,C;;;;;AAevCI,mB,GAAM,KAAKlB,eAAL,CAAqBa,OAAOM,SAA5B,C;;qBACPD,G;;;;;AACOJ,kB,GAAE,C;;;sBAAEA,KAAEI,IAAIZ,M;;;;;AACZS,kB,GAAIG,IAAIJ,EAAJ,C;;sBACL,OAAOC,EAAP,KAAa,U;;;;;;uBACGA,GAAEH,GAAF,C;;;AAAbI,sB;;AACJ,oBAAGA,MAAH,EAAS;AACPJ,sBAAIC,MAAJ,GAAaG,MAAb;AACD;;;;;sBACO,OAAOD,GAAEE,OAAT,KAAqB,U;;;;;;uBACZF,GAAEE,OAAF,CAAUL,GAAV,C;;;AAAbI,sB;;AACJ,oBAAGA,MAAH,EAAS;AACPJ,sBAAIC,MAAJ,GAAaG,MAAb;AACD;;;AAXoB,kBAAEF,E;;;;;;;;;;;;AAiB7B,oBAAG,KAAKb,YAAR,EAAsB;AACpB,uBAAKA,YAAL;AACD;;;;;;;;;;;;;;;;;;;;;kBAvEcJ,M","file":"Router.js","sourcesContent":["\nexport default class Router {\n  constructor(props) {\n    this.globalHandlers = [];\n    this.contextHandlers = {};\n    this.errorHandler = props.errorHandler;\n\n    [\n      'use',\n      'process'\n    ].forEach(fn=>this[fn]=this[fn].bind(this));\n  }\n\n  use(...args) {\n    if(args.length === 0) {\n      return this;\n    }\n    let context = args.shift();\n    if(typeof context === 'string') {\n      let ex = this.contextHandlers[context] || [];\n      args.forEach(a=>ex.push(a));\n      this.contextHandlers[context] = ex;\n    } else {\n      this.globalHandlers.push(context);\n    }\n    return this;\n  }\n\n  async process(ctx, bundle) {\n\n    ctx = {\n      ...ctx,\n      bundle\n    };\n\n    try {\n      for(let i=0;i<this.globalHandlers.length;++i) {\n        let h = this.globalHandlers[i];\n        if(typeof h === 'function') {\n          let outB = await h(ctx);\n          if(outB) {\n            ctx.bundle = outB;\n          }\n        } else if(typeof h.process === 'function') {\n          let outB = await h.process(ctx);\n          if(outB) {\n            ctx.bundle = outB;\n          }\n        }\n      }\n\n      let tgt = this.contextHandlers[bundle.fnContext];\n      if(tgt) {\n        for(let i=0;i<tgt.length;++i) {\n          let h = tgt[i];\n          if(typeof h === 'function') {\n            let outB = await h(ctx);\n            if(outB) {\n              ctx.bundle = outB;\n            }\n          } else if(typeof h.process === 'function') {\n            let outB = await h.process(ctx);\n            if(outB) {\n              ctx.bundle = outB;\n            }\n          }\n        }\n      }\n\n    } catch (e) {\n      if(this.errorHandler) {\n        this.errorHandler(e);\n      }\n    }\n  }\n}\n"]}